---
 - name: AiDiag tool installation and configuration
   hosts: localhost
   connection: local
   gather_facts: no
   ignore_errors: yes
   tasks:
      - name: Install nodejs
        apt:
          name: nodejs
          state: present
    
      - name: Install npm
        apt:
          name: npm
          state: present
    
      - name: Copying aidiag.js
        copy: 
          src: aidiag.js
          dest: /usr/local/bin/aidiag

      - name: Copying npm-dep.js
        copy: 
          src: npm-dep.js
          dest: /usr/local/bin/aidiag/npm-dep.js
      
      - name: Running npm install
        shell: cd /usr/local/bin/aidiag && npm init && npm install axios glob

      - name: Copying startup wrapper
        copy:
          src: aidiag
          dest: /usr/local/bin/aidiag

      - name: Sourcing bashrc
        shell: source ~/.bashrc